---
title: "lab15"
author: "allstars"
date: "12/10/2019"
output: html_document
---
```{r, message=F, warning=F, echo=F}
library(tidyverse)
temp <- tempfile()
regions <- read_csv("noc_regions.csv")
data1 <- unzip("athlete_events.csv.zip")
olympic_data <- read_csv("./athlete_events.csv")
```

## Overall Question: What attributes make the best athelete? 

The dataset we're using shows 120 years of Olympic history, showing athletes, gender, height, weight, age, country, season, sport/event, where the Olympics were, and the medal won
https://www.kaggle.com/heesoo37/120-years-of-olympic-history-athletes-and-results


```{r, message=F, warning=F, echo=F}
golds <- olympic_data %>%
  group_by(Medal, Age, Height, Weight) %>%
  summarise(medalnum = sum(!is.na(Medal)))

ggplot(data = golds) + geom_col(mapping = aes(x = Age, y = medalnum)) + 
  labs(y = "Medal Count", title = "Distribution of Medals Won vs Athlete Age")

ggplot(data = golds) + geom_point(mapping = aes(x = Height, y = medalnum)) +
  ylim(0, 13) +
  labs(y = "Medal Count", x = "Height in Cm", title = "Distribution of Medals Won vs Athlete Height")

ggplot(data = golds) + geom_col(mapping = aes(x = Weight, y = medalnum)) + 
  xlim(0, 175) +
  labs(y = "Medal Count", x = "Weight in Kg", title = "Distribution of Medals Won vs Athlete Weight")
```
These graphs show the distribution of the number of gold, silver, and bronze medals across all Olympic sports compared to three variables: age, height, and weight. It appears that the highest-scoring age is around 25 years old, height is about 175 cm, and weight is about 75 kg. These numbers could indicate ideal figures for the most successful athletes, however, the ideal age, height and weight to make the "best athlete" likely vary widely based on the sport.


## Individual Sections:

# Eugene Miller
# Sub-Question: Is the correlation for weight against height the same for winter and summer athelets? 

This question is important because it may reveal a certain body composition to be more favorable in the summer and a different one in the winter. As there are different sports played in the winter and summer seasons, we might expect to see a difference between the two seasons. However, it could also be the case that there is one ideal body/weight ratio for all atheletes regardless of slope, and this would be supported if linear models for weight vs height regressions were similar across season. 

I will use a linear model for weight versus height across two datatsets generating two seperate linear models. One dataset will consist of only data from the summer season, and the other only from the winter season. Comparing the two models will give insight into whether there is a difference between the two seasons. 

```{r, message = F, warning = F, echo = F}
library(modelr)

summer_data <- olympic_data %>% 
  filter(Season == "Summer") %>% 
  filter(!is.na(Weight) && !is.na(Height))

winter_data <- olympic_data %>% 
  filter(Season == "Winter") %>% 
  filter(!is.na(Weight) && !is.na(Height))

summer_mod <- lm(Height ~ Weight, data = summer_data)
winter_mod <- lm(Height ~ Weight, data = winter_data)

```

```{r, message = F, warning = F, echo = F}
summer_grid <- summer_data %>% 
  data_grid(Weight) %>% 
  gather_predictions(summer_mod)
                     
winter_grid <- winter_data %>% 
  data_grid(Weight) %>% 
  gather_predictions(winter_mod)

ggplot(summer_data, aes(Weight, Height)) +
  geom_point() +
  ggtitle("Summer") +
  theme(plot.title = element_text(hjust = 0.5)) +
  geom_line(data = summer_grid, aes(y = pred))

ggplot(winter_data, aes(Weight, Height)) +
  geom_point() +
  labs(title = "Winter") +
    theme(plot.title = element_text(hjust = 0.5)) +
  geom_line(data = winter_grid, aes(y = pred))
```

```{r, message = F, warning = F, echo = F}
summer_int <- summer_mod$coefficients[1]
summer_slope <- summer_mod$coefficients[2]
winter_int <- winter_mod$coefficients[1]
winter_slope <- winter_mod$coefficients[2]
```

We see the difference between summer and winter atheletes in terms of body composition is not very much, as the intercept for the best linear model of summer atheletes weight vs height is `r summer_int` and a slope of `r summer_slope`. For winter atheletes the intercept was `r winter_int` and a slope of `r winter_slope`. This suggests that the ideal body composition for winter and summer sports is overall similar, even when considering the range of sports that are played in both the winter and summer. It is noted that the deviance from the summer model is larger, but this could be explained by the wider variety of sports that are played in the summer (such as weightlifting and wrestling) and the larger number of datapoints. 

To determine whether this difference is indeed by chance or intrinsic in the real data, a permutation test is appropriate. By shuffling the olympic data into two subgroups representing "random" summer and winter seasons, modeling these datasets and comparing their difference in slopes with the difference in the real data we can determine if the difference in slopes between the two seasons in statistically significant. 

```{r, message = F, warning = F, echo = F}
delta_slope <- summer_slope - winter_slope
attr(delta_slope, "names") <- NULL
#222552 obs in summer, we will test to see if atheletes are randomly assigned to summer/winter data if the result is statistically significant.

delta_vec <- numeric(20)

for (i in c(1:20)){
  shuffle <- olympic_data[sample(nrow(olympic_data)),]
  
  samp_A <- shuffle[1:222552,]
  samp_B <- shuffle[222553:length(olympic_data),]
  
  mod_A <- lm(Height ~ Weight, data = samp_A)
  mod_B <- lm(Height ~ Weight, data = samp_B)
  
  slope_A<- mod_A$coefficients[2]
  slope_B<- mod_B$coefficients[2]
  d_slope <- slope_A - slope_B
  delta_vec[i] <- d_slope
}

p_value <- (1 - (sum(delta_vec < delta_slope)/20))
```

After conducting the test we have a p value of `r p_value` indicating there is a statistically significant difference between the slopes of the summer and winter models. Therefore the body types of atheletes that compete in winter vs summer games are statistically likely to be different. 

Note on computational efficiency: the way the permuation test was implemented was not very efficient as it forces the computer to fit many models. However, it was necessary to determine whether the real data was an outlier or not. I am not aware of any more effient way to program this function, but if there is a more efficent method please let me know, I'm sure it will be valuable at some point in the future.

The ethical implications of these findings are that they may impact coaches to influence their atheletes to adhere to more stringent programs in order for them to achieve the desired bodytype that is suggested as ideal in the models above. However, it should be noted that these models account for all olympic atheletes regardless of if they won medals or not. Therefore, strictly applying an athelete to the model may not result in improved results. 

Reflection: I think that for my six month and 5 year goals, my attitude has changed towards what I plan to be doing. I want to find a way I could apply statistics and programming in some socially responsible way. I feel like I understand much better what it means to do statistical programming because of this course, and see many areas where it could be applied but hasn't yet. I learned alot about R, and data-vis, and working in a team. I would tell myself to keep starting projects early, stop spending as much time on formatting/fine details, and start finishing class exercises at home. 

# Emily Archambault
# Sub-Question: How does the number of summer Olympic medals received by the United States compare to the other most populous countries in the world?

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(purrr)
olympics <- read_csv("./athlete_events.csv")
as_tibble(olympics)

olympics <- olympics %>%
  arrange(Year)

top5 <- olympics %>%
  filter(Team == "United States" | Team == "China" | Team == "India" | Team == "Indonesia" | Team == "Brazil") %>%
  filter(Season == "Summer") %>%
  filter(Year >= 1920) %>%
  group_by(Team, Year) %>%
  summarise(medals = sum(!is.na(Medal)))

top5 %>%
  split(.$Team) %>%
  map(~ lm(medals ~ Year, data = .))

ggplot(data = top5) + geom_point(mapping=aes(x= Year, y = medals, color = Team)) +
  geom_abline(intercept = -1196.0272, slope =  0.6168, color = "#F8766D") +
  geom_abline(intercept = -3120.649, slope =  1.607, color = "#7CAE00") +
  geom_abline(intercept = 244.4371, slope =  -0.1199, color = "#00BFC4") +
  geom_abline(intercept = -127.92308, slope =  0.06533, color = "#619CFF") +
  geom_abline(intercept = -2998.47, slope =  1.62, color = "#C77CFF") +
  labs(y = "Medal Count", title = "Summer Olympic Medals Won in the Past Century")
```

This question is interesting because you might think that those countries with the most people in them, and therefore the most potential athletic talent, would be scoring high numbers of medals. However, through my analysis, it turns out this isn't the case, so population count alone isn't a factor that contributes highly to overall medal count. The United States was the top scorer by far, while some countries were at practically zero (Indonesia) or had a downward trend (India). This relates to the overall question of what makes the best athlete by indicating that the size of the country they come from isn't an important thing to know- it likely has to do with something else, like the wealth of the country. The new tools I used were lm to match the data, and map to fit linear models to each country in the column. The ethical implications of these findings are that there is likely a vast amount of unrecognized athletic potential, given that some of the most populated areas aren't getting many Olympic medals, so perhaps the Olympics aren't a true measure of the "best in the world".

Reflection:
I don't think my goals have changed drastically, but this course has made me more interested in statistics and statistical analysis (and I'm taking a stats/programming class next semester now). I was very new to coding when I started this course, so I learned a lot about basic skills, and I think I have a good grasp of data visualization. If I could give advice to myself at the start of the semester, it would be to keep going to recitations/class all the time and keep starting the labs early in the week so I have time to work through them. I would tell myself to start trying to find examples of what the readings were about from outside of the book (videos, other websites, etc.) so I'd have a better idea of how those techniques are used.

# Johnny Tamanaha

# Sub-Question: Is there a difference between the mean weight percentile for gold medal winning athletes in summer and winter olympics? 

This question is important because it could point to trends for preferable body compositions for summer and winter sports. 

I will use a permutation test to compare means. My null hypothesis is that there is no difference between the means of weight percentile for summer and winter athletes. 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
data1 <- read_csv("./athlete_events.csv")

data_grouped_summer <- data1 %>%
  filter(!is.na(Weight), Season=="Summer") %>%
  group_by(Sport, Year, Sex, Season) %>%
  nest()
data_grouped_winter <- data1 %>%
  filter(!is.na(Weight), Season=="Winter") %>%
  group_by(Sport, Year, Sex, Season) %>%
  nest()

data_gold_summer <- data1 %>%
  filter(Medal=="Gold", !is.na(Weight), Season=="Summer") %>%
  select(Sport, Year, Sex, Medal, Weight, Season)
data_gold_winter <- data1 %>%
  filter(Medal=="Gold", !is.na(Weight), Season=="Winter") %>%
  select(Sport, Year, Sex, Medal, Weight, Season)

data_all_summer <- inner_join(data_gold_summer, data_grouped_summer, by=c("Sport", "Year", "Sex", "Season"))
data_all_winter <- inner_join(data_gold_winter, data_grouped_winter, by=c("Sport", "Year", "Sex", "Season"))

percentiles_summer <- vector("double")
for (i in 1:nrow(data_all_summer)) {
  percentiles_summer[i] <- sum(data_all_summer$data[[i]]$Weight > data_all_summer$Weight[[i]]) / nrow(data_all_summer$data[[i]])
}
mean_summer <- mean(percentiles_summer)

percentiles_winter <- vector("double")
for(i in 1:nrow(data_all_winter)) {
  percentiles_winter[i] <- sum(data_all_winter$data[[i]]$Weight > data_all_winter$Weight[[i]]) / nrow(data_all_winter$data[[i]])
}
mean_winter <- mean(percentiles_winter)

mean_all <- c(percentiles_summer, percentiles_winter)
mean_diff_actual <- mean_summer - mean_winter

mean_diff_sim <- vector("double")
for (i in 1:1000) {
  sim <- sample(mean_all)
  sim_summer <- sim[1:length(percentiles_summer)]
  sim_winter <- sim[(length(percentiles_summer)+1):length(sum)]
  mean_diff_sim[i] <- mean(sim_summer) - mean(sim_winter)
}

ggplot() +
  geom_histogram(aes(mean_diff_sim), color="Black", fill="White") +
  labs(title="Mean Difference Permutation Test of Weight Percentiles") +
  ylab("Count") +
  xlab("Mean Difference")
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
ggplot() +
  geom_histogram(aes(mean_diff_sim), color="Black", fill="White", bins=100) +
  geom_vline(xintercept=mean_diff_actual, color="Red") +
  labs(title="Actual Mean Difference of Weight Percentiles") +
  xlab("Mean Difference")+
  ylab("Count")

```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
percentile <- sum(mean_diff_sim <= mean_diff_actual) / length(mean_diff_sim)
percentile
```

I found that there is a significant difference between the mean weight percentile and it is higher for summer athletes. There are no glaring ethical implications of this finding. This shows that summer sports optimize with athletes that are in a higher weight percentile than winter sports. 

Reflection: I feel like we achieved our main goals as a team for the course. Our comfortability with data analysis increased as the semester went on. Also, our teamwork got a lot better. If I could go back in time I would suggest that our team create and maintain better communication habits. It wasn't a huge issue, but sometimes things got a little confusing near the deadline. I feel like this class has only reinforced my long term goals as a data scientists. It is easy to see how the skills from this class will apply to other projects in the future. If I could go back in time I would tell myself to read the book earlier. 

# Jingzhi Zhang

# Sub-Question: How does the age of athletes affects the number of medals their country totally win in 2016?

 

```{r, echo=FALSE, message=FALSE, warning=FALSE}

library(tidyverse)

library(purrr)

olympic <- read_csv("./athlete_events.csv")

as_tibble(olympic)

 

olympic %>%

  arrange(Year)

one_country <- olympic %>%

  filter(Year == 2016) %>%

  group_by(Age, Year) %>%

  select(-Sex, -Sport, -Event, -City, -NOC, -Height, -Weight, -Season, -Games) %>%

 summarise(medals = sum(!is.na(Medal)))

 

ggplot(data = one_country) +

  geom_col(mapping = aes(x = Age, y = medals), position = "stack", width = NULL, na.rm = FALSE, show.legend = NA,

  inherit.aes = TRUE)+

  labs(y = "Total Medals", title = "Olympic Medals Won in year 2016")

```

I think the question is interesting because people may think that Athlete as a profession is different from other professions, it is greatly affected by age. Through my analysis, to some extent confirms the opinion of the majority that age do affect the performance of an athlete. We can see from the graph, in year 2016, athletes between the ages of 20 and 30 receive the most medals. As age increasing, athletes receive fewer medals. Although I only chose 2016 as the analysis target, we can use the same method to infer that the number of medals won by athletes worldwide in other years will gradually decrease after the age of 30. From the image we can also get that the golden age of athletes is between 20 and 30. This relates to the overall question of what makes the best athlete by indicating that the more golden age members in a group, the more likely they will win more medals.

 

Reflection:

I think my goals stay the same, and I strengthened my determination to study statistics. I'm planing to take more classes about stats and programming next semester. I have never been exposed to any programming language before this semester, so learning both C ++ and R at this semester is a huge challenge for me. I put a lot of effort into supplementing my programming knowledge.But I still feel that a lot of knowledge has not been digested. If I could give advice to myself at the start of the semester, I would tell myself not to be afraid of programming psychologicallyit and don't be afraid to discuss with others when you encounter problems. Don't be shy to ask good people for advice, because the worst result of asking for help is simply being rejected, and most of the time you will get help.


### Team Reflection

Original Goal (From Lab 2): To work together effectively to analyze data and come to relevant conclusions.

For the most part, we think we achieved this goal pretty well. We all strengthened our data analysis skills and were successful in the labs, and usually worked well together as a group. If we could give ourselves advice, it would be to keep meeting up to work on labs, and try to go to class and recitation as much as possible to solidfy what we were learning. Another thing would be to make sure to divide up the lab work at the start of the week so the expectations for everyone were clear.